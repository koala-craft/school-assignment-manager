# PostgreSQL パフォーマンス最適化設定
# Docker on Windows 環境向け

# メモリ設定
shared_buffers = 256MB              # 共有メモリバッファ（コンテナメモリの25%程度）
effective_cache_size = 1GB          # 利用可能なキャッシュサイズ
work_mem = 16MB                     # ソート・ハッシュ作業用メモリ
maintenance_work_mem = 128MB        # メンテナンス作業用メモリ

# 接続設定
max_connections = 100                # 最大接続数
superuser_reserved_connections = 3

# クエリプランナー
random_page_cost = 1.1              # SSD向け（デフォルト4.0はHDD向け）
effective_io_concurrency = 200      # 並行I/O数（SSD向け）

# ログ設定（開発環境）
logging_collector = on
log_destination = 'stderr'
log_min_duration_statement = 100    # 100ms以上のクエリをログに記録
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '

# 自動バキューム（開発環境では緩めに）
autovacuum = on
autovacuum_naptime = 10s

# チェックポイント
checkpoint_timeout = 10min
checkpoint_completion_target = 0.9

# WAL設定
wal_buffers = 16MB
min_wal_size = 1GB
max_wal_size = 4GB
