# 学校提出物管理アプリ 画面遷移図

## 目次

1. [全体遷移図](#1-全体遷移図)
2. [認証フロー](#2-認証フロー)
3. [管理者フロー](#3-管理者フロー)
4. [教員フロー](#4-教員フロー)
5. [管理者学生フロー](#5-管理者学生フロー)
6. [一般学生フロー](#6-一般学生フロー)

---

## 1. 全体遷移図

```mermaid
graph TB
    Start([アプリ起動]) --> Login[ログイン画面]
    Login --> CheckRole{ロール判定}
    
    CheckRole -->|管理者| AdminDash[管理者ダッシュボード]
    CheckRole -->|教員| TeacherDash[教員ダッシュボード]
    CheckRole -->|管理者学生| SADash[管理者学生ダッシュボード]
    CheckRole -->|一般学生| StudentDash[学生ダッシュボード]
    
    AdminDash --> AdminFlow[管理者機能群]
    TeacherDash --> TeacherFlow[教員機能群]
    SADash --> SAFlow[管理者学生機能群]
    StudentDash --> StudentFlow[学生機能群]
    
    AdminFlow --> Logout[ログアウト]
    TeacherFlow --> Logout
    SAFlow --> Logout
    StudentFlow --> Logout
    
    Logout --> Login
    
    style Login fill:#e1f5ff
    style AdminDash fill:#fff3cd
    style TeacherDash fill:#d1ecf1
    style SADash fill:#d4edda
    style StudentDash fill:#f8d7da
```

---

## 2. 認証フロー

```mermaid
graph TB
    Start([アプリ起動]) --> CheckAuth{認証状態確認}
    CheckAuth -->|未認証| Login[ログイン画面]
    CheckAuth -->|認証済み| CheckFirst{初回ログイン?}
    
    Login --> InputCred[メールアドレス<br/>パスワード入力]
    InputCred --> ValidateCred{認証成功?}
    
    ValidateCred -->|失敗| ErrorMsg[エラーメッセージ表示]
    ErrorMsg --> Login
    
    ValidateCred -->|成功| CheckFirst
    
    CheckFirst -->|Yes| ForcePassChange[パスワード変更画面<br/>強制遷移]
    ForcePassChange --> ChangePass[パスワード変更]
    ChangePass --> Dashboard
    
    CheckFirst -->|No| Dashboard[ダッシュボード<br/>ロール別]
    
    Login -.パスワード忘れ.-> PassResetReq[パスワードリセット<br/>要求画面]
    PassResetReq --> SendMail[リセットメール送信]
    SendMail --> PassResetExec[パスワードリセット<br/>実行画面]
    PassResetExec --> ResetComplete[リセット完了]
    ResetComplete --> Login
    
    Dashboard --> Profile[プロフィール編集]
    Profile --> Dashboard
    
    Dashboard --> PassChange[パスワード変更]
    PassChange --> Dashboard
    
    Dashboard --> Logout[ログアウト]
    Logout --> Login
    
    style Login fill:#e1f5ff
    style Dashboard fill:#d4edda
    style ForcePassChange fill:#fff3cd
```

---

## 3. 管理者フロー

```mermaid
graph TB
    Login[ログイン] --> AdminDash[管理者ダッシュボード]
    
    AdminDash --> UserMgmt[ユーザー管理]
    AdminDash --> AcademicMgmt[年度・学期管理]
    AdminDash --> SystemSettings[システム設定]
    AdminDash --> BackupMgmt[バックアップ管理]
    AdminDash --> AuditLog[監査ログ]
    AdminDash --> DataImport[データインポート]
    AdminDash --> TeacherFeatures[教員機能も利用可能]
    
    subgraph "ユーザー管理"
        UserMgmt --> UserList[ユーザー一覧]
        UserList --> UserCreate[新規登録]
        UserList --> UserEdit[編集]
        UserList --> UserDeactivate[無効化]
        UserCreate --> UserList
        UserEdit --> UserList
        UserDeactivate --> UserList
    end
    
    subgraph "年度・学期管理"
        AcademicMgmt --> YearMgmt[年度管理]
        YearMgmt --> YearCreate[年度作成]
        YearMgmt --> YearEdit[年度編集]
        YearMgmt --> YearSwitch[年度切替]
        
        AcademicMgmt --> TermMgmt[学期管理]
        TermMgmt --> TermCreate[学期作成]
        TermMgmt --> TermEdit[学期編集]
        
        YearCreate --> YearMgmt
        YearEdit --> YearMgmt
        TermCreate --> TermMgmt
        TermEdit --> TermMgmt
    end
    
    subgraph "システム設定"
        SystemSettings --> MailSettings[メール設定]
        SystemSettings --> NotifSettings[通知設定]
        SystemSettings --> FileSettings[ファイル設定]
        SystemSettings --> SecuritySettings[セキュリティ設定]
        
        MailSettings --> TestSend[テスト送信]
        TestSend --> MailSettings
        
        MailSettings --> SystemSettings
        NotifSettings --> SystemSettings
        FileSettings --> SystemSettings
        SecuritySettings --> SystemSettings
    end
    
    subgraph "バックアップ"
        BackupMgmt --> BackupList[バックアップ一覧]
        BackupList --> ManualBackup[手動バックアップ実行]
        BackupList --> Download[ダウンロード]
        BackupList --> Delete[削除]
        
        ManualBackup --> BackupList
        Download --> BackupList
        Delete --> BackupList
    end
    
    subgraph "監査ログ"
        AuditLog --> LogList[ログ一覧]
        LogList --> LogDetail[ログ詳細]
        LogList --> LogExport[CSV出力]
        
        LogDetail --> LogList
        LogExport --> LogList
    end
    
    subgraph "データインポート"
        DataImport --> SelectType[対象選択]
        SelectType --> UploadCSV[CSVアップロード]
        UploadCSV --> Preview[プレビュー]
        Preview --> Execute[インポート実行]
        Execute --> Result[結果表示]
        Result --> DataImport
    end
    
    UserMgmt --> AdminDash
    AcademicMgmt --> AdminDash
    SystemSettings --> AdminDash
    BackupMgmt --> AdminDash
    AuditLog --> AdminDash
    DataImport --> AdminDash
    
    style AdminDash fill:#fff3cd
    style UserMgmt fill:#e7f3ff
    style SystemSettings fill:#ffe7e7
```

---

## 4. 教員フロー

```mermaid
graph TB
    Login[ログイン] --> TeacherDash[教員ダッシュボード]
    
    TeacherDash --> SubjectMgmt[科目管理]
    TeacherDash --> AssignmentMgmt[提出物管理]
    TeacherDash --> Grading[採点]
    TeacherDash --> Reports[レポート出力]
    TeacherDash --> Notifications[通知一覧]
    
    subgraph "科目管理フロー"
        SubjectMgmt --> SubjectList[科目一覧]
        SubjectList --> SubjectCreate[科目作成<br/>管理者のみ]
        SubjectList --> SubjectEdit[科目編集<br/>担当教員]
        SubjectList --> EnrollmentMgmt[履修管理]
        
        SubjectCreate --> SubjectList
        SubjectEdit --> SubjectList
        
        EnrollmentMgmt --> EnrollList[履修学生一覧]
        EnrollList --> EnrollAdd[履修登録]
        EnrollList --> EnrollRemove[履修解除]
        EnrollList --> EnrollImport[CSVインポート]
        EnrollList --> EnrollExport[CSV出力]
        
        EnrollAdd --> EnrollList
        EnrollRemove --> EnrollList
        EnrollImport --> EnrollList
        EnrollExport --> EnrollList
        EnrollList --> SubjectList
    end
    
    subgraph "提出物管理フロー"
        AssignmentMgmt --> AssignList[提出物一覧]
        AssignList --> AssignCreate[提出物作成]
        AssignList --> AssignEdit[提出物編集]
        AssignList --> TemplateUse[テンプレートから作成]
        AssignList --> SubmissionMatrix[提出状況マトリクス]
        
        AssignCreate --> AssignList
        AssignEdit --> AssignList
        TemplateUse --> AssignList
        
        SubmissionMatrix --> SubmDetail[提出物詳細]
        SubmDetail --> GradeForm[採点フォーム]
        SubmDetail --> ResubmitReq[再提出指示]
        SubmDetail --> FileDownload[ファイルダウンロード]
        
        GradeForm --> SubmDetail
        ResubmitReq --> SubmDetail
        FileDownload --> SubmDetail
        SubmDetail --> SubmissionMatrix
        SubmissionMatrix --> AssignList
    end
    
    subgraph "テンプレート管理"
        AssignmentMgmt --> TemplateList[テンプレート一覧]
        TemplateList --> TemplateCreate[テンプレート作成]
        TemplateList --> TemplateEdit[テンプレート編集]
        TemplateList --> TemplateDelete[テンプレート削除]
        
        TemplateCreate --> TemplateList
        TemplateEdit --> TemplateList
        TemplateDelete --> TemplateList
    end
    
    subgraph "採点フロー"
        Grading --> GradingList[未採点一覧]
        GradingList --> GradingDetail[採点画面]
        GradingDetail --> InputGrade[点数/評価入力]
        GradingDetail --> InputComment[コメント入力]
        InputGrade --> SaveGrade[採点保存]
        InputComment --> SaveGrade
        SaveGrade --> NextStudent{次の学生へ}
        NextStudent -->|続ける| GradingDetail
        NextStudent -->|終了| GradingList
        GradingList --> Grading
    end
    
    subgraph "レポート出力"
        Reports --> SelectReport[レポート種類選択]
        SelectReport --> SetCondition[出力条件設定]
        SetCondition --> SelectFormat[形式選択<br/>CSV/Excel/PDF]
        SelectFormat --> Export[出力実行]
        Export --> Reports
    end
    
    SubjectMgmt --> TeacherDash
    AssignmentMgmt --> TeacherDash
    Grading --> TeacherDash
    Reports --> TeacherDash
    
    style TeacherDash fill:#d1ecf1
    style SubjectMgmt fill:#e7f3ff
    style AssignmentMgmt fill:#fff9e7
    style Grading fill:#ffe7f0
```

---

## 5. 管理者学生フロー

```mermaid
graph TB
    Login[ログイン] --> SADash[管理者学生<br/>ダッシュボード]
    
    SADash --> AssignedSubjects[担当科目一覧]
    SADash --> UpdateSubmission[提出状況更新]
    SADash --> ViewHistory[更新履歴確認]
    SADash --> Notifications[通知一覧]
    SADash --> StudentFeatures[学生機能も利用可能]
    
    subgraph "提出状況更新フロー"
        UpdateSubmission --> SelectSubject[科目選択]
        SelectSubject --> SelectAssignment[提出物選択]
        SelectAssignment --> SubmissionMatrix[提出状況マトリクス]
        
        SubmissionMatrix --> CheckStatus{現在の状態}
        CheckStatus -->|未提出| MarkSubmitted[提出済みに変更]
        CheckStatus -->|再提出待ち| MarkResubmitted[再提出済みに変更]
        CheckStatus -->|その他| ViewOnly[閲覧のみ]
        
        MarkSubmitted --> ConfirmUpdate[確認ダイアログ]
        MarkResubmitted --> ConfirmUpdate
        ConfirmUpdate --> UpdateDB[状態更新]
        UpdateDB --> LogHistory[履歴記録]
        LogHistory --> SubmissionMatrix
        
        ViewOnly --> SubmissionMatrix
        SubmissionMatrix --> SADash
    end
    
    subgraph "更新履歴"
        ViewHistory --> HistoryList[更新履歴一覧]
        HistoryList --> FilterDate[日付フィルター]
        HistoryList --> FilterSubject[科目フィルター]
        FilterDate --> HistoryList
        FilterSubject --> HistoryList
        HistoryList --> ViewHistory
    end
    
    AssignedSubjects --> SADash
    UpdateSubmission --> SADash
    ViewHistory --> SADash
    
    style SADash fill:#d4edda
    style UpdateSubmission fill:#fff9e7
```

---

## 6. 一般学生フロー

```mermaid
graph TB
    Login[ログイン] --> StudentDash[学生ダッシュボード]
    
    StudentDash --> AssignmentList[課題一覧]
    StudentDash --> GradeView[成績閲覧]
    StudentDash --> SubjectView[科目別課題]
    StudentDash --> Notifications[通知一覧]
    
    subgraph "課題一覧フロー"
        AssignmentList --> TabSwitch{タブ切り替え}
        TabSwitch -->|未対応| NotDone[未対応課題]
        TabSwitch -->|対応済み| Done[対応済み課題]
        TabSwitch -->|全て| All[全課題]
        
        NotDone --> FilterSubject[科目フィルター]
        Done --> FilterSubject
        All --> FilterSubject
        
        FilterSubject --> SortOrder[ソート<br/>締切順/科目順]
        SortOrder --> CardList[課題カード一覧]
        
        CardList --> SelectCard{課題選択}
        SelectCard --> AssignDetail[課題詳細・提出画面]
    end
    
    subgraph "課題詳細・提出フロー"
        AssignDetail --> ViewDetail[課題詳細表示]
        ViewDetail --> CheckSubmitted{提出済み?}
        
        CheckSubmitted -->|未提出| ShowSubmitForm[提出フォーム表示]
        CheckSubmitted -->|提出済み| ShowSubmission[提出内容表示]
        
        ShowSubmitForm --> UploadFile[ファイルアップロード<br/>ドラッグ&ドロップ]
        ShowSubmitForm --> InputComment[コメント入力]
        
        UploadFile --> ValidateFile{ファイル検証}
        ValidateFile -->|エラー| ShowError[エラーメッセージ]
        ShowError --> ShowSubmitForm
        ValidateFile -->|OK| FileList[ファイルリスト表示]
        
        FileList --> InputComment
        InputComment --> PreviewSubmit[提出内容プレビュー]
        PreviewSubmit --> ConfirmSubmit[提出確認ダイアログ]
        ConfirmSubmit -->|確認| ExecuteSubmit[提出実行]
        ConfirmSubmit -->|キャンセル| PreviewSubmit
        
        ExecuteSubmit --> SubmitSuccess[提出完了メッセージ]
        SubmitSuccess --> ShowSubmission
        
        ShowSubmission --> ViewFiles[提出ファイル表示]
        ShowSubmission --> ViewMyComment[自分のコメント表示]
        ShowSubmission --> CheckGraded{採点済み?}
        
        CheckGraded -->|Yes| ViewGrade[点数/評価表示]
        CheckGraded -->|Yes| ViewTeacherComment[教員コメント表示]
        CheckGraded -->|No| WaitGrade[採点待ち表示]
        
        ViewGrade --> CheckResubmit{再提出要求?}
        CheckResubmit -->|Yes| ShowResubmitReq[再提出指示表示]
        ShowResubmitReq --> ShowSubmitForm
        CheckResubmit -->|No| AssignDetail
        
        WaitGrade --> AssignDetail
        ViewFiles --> AssignDetail
        AssignDetail --> AssignmentList
    end
    
    subgraph "成績閲覧フロー"
        GradeView --> SelectPeriod[年度・学期選択]
        SelectPeriod --> SelectGradeSubject[科目選択]
        SelectGradeSubject --> GradeList[成績一覧表示<br/>アコーディオン]
        
        GradeList --> ExpandSubject{科目展開}
        ExpandSubject --> DetailGrade[課題別成績表示]
        DetailGrade --> ViewGradeDetail[詳細表示]
        ViewGradeDetail --> GradeList
        
        GradeList --> ExportPDF[PDF出力]
        ExportPDF --> GradeList
        GradeList --> GradeView
    end
    
    subgraph "科目別課題フロー"
        SubjectView --> SubjectList[履修科目一覧]
        SubjectList --> SelectSubject[科目選択]
        SelectSubject --> SubjectAssignList[科目別課題一覧]
        SubjectAssignList --> SubjectAssignDetail[課題詳細]
        SubjectAssignDetail --> SubjectAssignList
        SubjectAssignList --> SubjectView
    end
    
    AssignmentList --> StudentDash
    GradeView --> StudentDash
    SubjectView --> StudentDash
    
    style StudentDash fill:#f8d7da
    style AssignmentList fill:#fff9e7
    style AssignDetail fill:#e7f3ff
    style GradeView fill:#e7ffe7
```

---

## 7. 通知フロー（全ロール共通）

```mermaid
graph TB
    AnyPage[任意のページ] --> NotifIcon[通知アイコンクリック]
    NotifIcon --> NotifPopup{ポップアップ表示}
    
    NotifPopup --> QuickView[未読通知表示<br/>最新5件]
    QuickView --> ViewAll[全て見るリンク]
    QuickView --> MarkRead[個別既読化]
    
    ViewAll --> NotifList[通知一覧画面]
    MarkRead --> NotifPopup
    
    NotifList --> TabSwitch{タブ切り替え}
    TabSwitch -->|未読| UnreadList[未読一覧]
    TabSwitch -->|全て| AllList[全通知一覧]
    
    UnreadList --> MarkAllRead[全て既読ボタン]
    AllList --> MarkAllRead
    
    MarkAllRead --> NotifList
    
    UnreadList --> SelectNotif[通知選択]
    AllList --> SelectNotif
    
    SelectNotif --> NotifDetail[通知詳細画面]
    NotifDetail --> AutoMarkRead[自動既読化]
    AutoMarkRead --> ShowDetail[詳細内容表示]
    ShowDetail --> ActionButton[アクションボタン]
    
    ActionButton -->|関連画面へ| RelatedPage[該当画面へ遷移]
    RelatedPage --> AnyPage
    
    ShowDetail --> NotifList
    NotifList --> AnyPage
    
    NotifList --> NotifSettings[通知設定]
    NotifSettings --> ToggleSettings[設定変更]
    ToggleSettings --> NotifSettings
    NotifSettings --> NotifList
    
    style NotifIcon fill:#fff3cd
    style NotifList fill:#e7f3ff
```

---

## 8. 共通アクション遷移

```mermaid
graph TB
    AnyPage[任意のページ] --> CommonActions{共通アクション}
    
    CommonActions --> Profile[プロフィール編集]
    Profile --> UpdateProfile[情報更新]
    UpdateProfile --> Profile
    Profile --> AnyPage
    
    CommonActions --> PassChange[パスワード変更]
    PassChange --> ValidatePass{現在のパスワード<br/>検証}
    ValidatePass -->|失敗| PassError[エラー表示]
    PassError --> PassChange
    ValidatePass -->|成功| InputNewPass[新パスワード入力]
    InputNewPass --> SaveNewPass[保存]
    SaveNewPass --> Success[成功メッセージ]
    Success --> AnyPage
    
    CommonActions --> Notifications[通知一覧]
    Notifications --> AnyPage
    
    CommonActions --> Help[ヘルプ・FAQ]
    Help --> SearchFAQ[FAQ検索]
    SearchFAQ --> Help
    Help --> AnyPage
    
    CommonActions --> Logout[ログアウト]
    Logout --> ConfirmLogout[確認ダイアログ]
    ConfirmLogout -->|確認| ClearSession[セッションクリア]
    ConfirmLogout -->|キャンセル| AnyPage
    ClearSession --> Login[ログイン画面]
    
    style AnyPage fill:#e7f3ff
    style CommonActions fill:#fff3cd
```

---

## 9. エラーハンドリング遷移

```mermaid
graph TB
    UserAction[ユーザー操作] --> ProcessAction[アクション処理]
    
    ProcessAction --> CheckResult{処理結果}
    
    CheckResult -->|成功| ShowSuccess[成功トースト表示]
    ShowSuccess --> OriginalPage[元のページ]
    
    CheckResult -->|400系エラー| ClientError{エラー種別}
    ClientError -->|400| ShowValidation[バリデーションエラー<br/>表示]
    ClientError -->|401| RedirectLogin[ログイン画面へ<br/>リダイレクト]
    ClientError -->|403| ShowForbidden[権限エラー画面]
    ClientError -->|404| ShowNotFound[404画面]
    
    ShowValidation --> OriginalPage
    ShowForbidden --> ErrorBack[戻るボタン]
    ShowNotFound --> ErrorBack
    ErrorBack --> OriginalPage
    
    CheckResult -->|500系エラー| ServerError{エラー種別}
    ServerError -->|500| ShowServerError[500エラー画面]
    ServerError -->|503| ShowMaintenance[メンテナンス画面]
    
    ShowServerError --> ErrorRetry[再試行ボタン]
    ErrorRetry --> ProcessAction
    ShowServerError --> ErrorContact[お問い合わせ]
    ErrorContact --> Help[ヘルプページ]
    
    ShowMaintenance --> WaitMaintenance[メンテナンス終了待ち]
    WaitMaintenance --> RedirectLogin
    
    style UserAction fill:#e7f3ff
    style ShowSuccess fill:#d4edda
    style ShowValidation fill:#fff3cd
    style ShowServerError fill:#f8d7da
```

---

## 10. ファイル操作フロー

```mermaid
graph TB
    Start[ファイル操作開始] --> OperationType{操作種類}
    
    OperationType -->|アップロード| SelectFiles[ファイル選択]
    SelectFiles --> DragDrop{ドラッグ&ドロップ or<br/>ファイル選択}
    
    DragDrop --> ValidateType{ファイル形式<br/>検証}
    ValidateType -->|エラー| ShowTypeError[形式エラー表示]
    ShowTypeError --> SelectFiles
    
    ValidateType -->|OK| ValidateSize{ファイルサイズ<br/>検証}
    ValidateSize -->|エラー| ShowSizeError[サイズエラー表示]
    ShowSizeError --> SelectFiles
    
    ValidateSize -->|OK| ShowPreview[プレビュー表示]
    ShowPreview --> CheckCount{ファイル数確認}
    CheckCount -->|上限超過| ShowCountError[ファイル数エラー]
    ShowCountError --> SelectFiles
    
    CheckCount -->|OK| UploadConfirm[アップロード確認]
    UploadConfirm --> ExecuteUpload[アップロード実行]
    ExecuteUpload --> ShowProgress[進捗表示]
    ShowProgress --> UploadComplete[完了]
    
    OperationType -->|ダウンロード| SelectDownload[ファイル選択]
    SelectDownload --> SingleOrBulk{単一 or 一括}
    
    SingleOrBulk -->|単一| DirectDownload[直接ダウンロード]
    SingleOrBulk -->|一括| CreateZip[ZIP作成]
    CreateZip --> ZipProgress[ZIP作成進捗]
    ZipProgress --> ZipDownload[ZIPダウンロード]
    
    DirectDownload --> DownloadComplete[ダウンロード完了]
    ZipDownload --> DownloadComplete
    
    OperationType -->|削除| SelectDelete[ファイル選択]
    SelectDelete --> ConfirmDelete[削除確認]
    ConfirmDelete -->|キャンセル| Cancel[キャンセル]
    ConfirmDelete -->|確認| ExecuteDelete[削除実行]
    ExecuteDelete --> DeleteComplete[削除完了]
    
    UploadComplete --> End[操作終了]
    DownloadComplete --> End
    DeleteComplete --> End
    Cancel --> End
    
    style Start fill:#e7f3ff
    style UploadComplete fill:#d4edda
    style DownloadComplete fill:#d4edda
    style DeleteComplete fill:#d4edda
```

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|---------|
| 2024-04-15 | 1.0.0 | 初版作成 |
